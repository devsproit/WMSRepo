"use strict";function onChange(n){var i=n.sender.select(),t=[];i.each(function(){var n=$("#myGrid").data("kendoGrid"),i=n.dataItem(this);t.push(i)});fildetails(t);console.log(t)}function additionalData(){var n={pono:$("#ponumber").val()};return addAntiForgeryToken(n),n}function fildetails(n){$("#Material").val(n[0].MaterialDescription);$("#MaterialCode").val(n[0].SubItemCode);$("#qtyu,#Qtysuk,#QtyD,#QtyO,#QtyI").val(n[0].Qty);$("#sendercompany").val(n[0].SenderCompany);$("#sender").val(n[0].Branch);itemLocation(n[0].SubItemCode)}function warehouse(){$.ajax({type:"GET",url:"/Grn/Warehouse","async":!1,success:function(n){for(var i="",t=0;t<n.length;t++)i+='<option value="'+n[t].Id+'" data-code='+n[t].WarehouseCode+">"+n[t].WarehouseName+"<\/option>";$("#WarehouseId").html(i)}});zones($("#WarehouseId").val())}function zones(n){$.ajax({type:"GET",url:"/Grn/WarehouseZone?warehouseid="+n,data:"{}",success:function(n){for(var i="",t=0;t<n.length;t++)i+='<option value="'+n[t].Id+'" data-code='+n[t].ZoneCode+">"+n[t].ZoneName+"<\/option>";$("#zone").html(i);$("#zone").trigger("change")}});area($("#WarehouseId").val(),$("#zone").val())}function area(n,t){$.ajax({type:"GET",url:"/Grn/WarehouseArea?warehouseid="+n+"&zoneid="+t,data:"{}",success:function(n){for(var i="",t=0;t<n.length;t++)i+='<option value="'+n[t].Id+'" data-code='+n[t].AreaCode+"  data-size="+n[t].Size+">"+n[t].AreaName+"<\/option>";$("#Warea").html(i);$("#Warea").trigger("change")}})}function validation(){var n=$("#myGrid").data("kendoGrid");if($("#doctype").val()==="PO"){if($("#ponumber").val()==undefined||$("#ponumber").val()==="")return alert("Please select PO number."),!1;if($("#invoiceNo").val()===undefined||$("#invoiceNo").val()==="")return alert("Please enter invoice no."),!1;if($("#grnnumbersap").val()===undefined||$("#grnnumbersap").val()==="")return alert("Please enter GRN no. from SAP"),!1;if($("#irn").val()===undefined||$("#irn").val()==="")return alert("Please enter IRN"),!1}else{if($("#invoiceNo").val()===undefined||$("#invoiceNo").val()==="")return alert("Please enter invoice no."),!1;if(n._data.length==0)return alert("Please add items."),!1}return!0}function itemLocation(n){$.ajax({type:"GET",url:"/Grn/GetItemLocation?subItemCode="+n,data:"{}",success:function(n){console.log(n);$("#WarehouseId").val(n.WareHouseId).trigger("change");var t=n.WareHouseId,i=n.WareHouseAreaId,r=n.LocationId;$.ajax({type:"GET",url:"/Grn/WarehouseZone?warehouseid="+t,data:"{}",success:function(n){for(var f="",u=0;u<n.length;u++)f+='<option value="'+n[u].Id+'" data-code='+n[u].ZoneCode+">"+n[u].ZoneName+"<\/option>";$("#zone").html(f);console.log("zone loalded");$("#zone").val(i);$.ajax({type:"GET",url:"/Grn/WarehouseArea?warehouseid="+t+"&zoneid="+i,data:"{}",success:function(n){for(var i="",t=0;t<n.length;t++)i+='<option value="'+n[t].Id+'" data-code='+n[t].AreaCode+"  data-size="+n[t].Size+">"+n[t].AreaName+"<\/option>";$("#Warea").html(i);$("#Warea").val(r)}})}})}})}function pleaseWait(){$("#pleaseWait").modal({backdrop:"static",keyboard:!1})}function hideloading(){$("#pleaseWait").on("shown.bs.modal",function(){$(this).hide();$(".modal").modal("hide")})}$(function(){$("#ponumber").select2({theme:"bootstrap4",ajax:{url:"/Grn/PendingPO",dataType:"json",type:"GET",data:function(n){return{term:n.term}},processResults:function(n){return console.log(n),{results:$.map(n,function(n){return{text:n,id:n}})}}}})});var grndata=[];$(document).ready(function(){warehouse();$("#WarehouseId").change(function(){var n=$(this).find("option:selected"),t=n.attr("data-code");$("#wcode").val(t)});$("#WarehouseId").trigger("change");$("#zone").change(function(){var n=$(this).find("option:selected"),t=n.attr("data-code");$("#zcode").val(t);area($("#WarehouseId").val(),$("#zone").val())});$("#zone").trigger("change");$("#Warea").change(function(){var n=$(this).find("option:selected"),t=n.attr("data-code");$("#acode").val(t)});$("#Warea").trigger("change");$("#ponumber").on("change",function(){$("#ponumber_details").val($("#ponumber").val());var n=$("#myGrid").data("kendoGrid");n.dataSource.page(1)});$("#doctype").on("change",function(){$(this).val()==="PO"?$("#ponumber-area").show():$("#ponumber-area").hide()});var n=!0;$("#myGrid").kendoGrid({dataSource:{transport:{read:{url:"/Grn/PODetails",type:"POST",dataType:"json",data:additionalData,complete:function(n){console.log("Remote built-in transport",n);n.status==401}}},schema:{data:"Data",total:"Total",errors:"Errors"},error:function(n){console.log(n);this.cancelChanges()},pageSize:20,sortable:!0,serverPaging:!0,serverSorting:!0,requestStart:function(){n&&kendo.ui.progress($("#booking-grid"),!0)},requestEnd:function(){n&&kendo.ui.progress($("#booking-grid"),!1);n=!1}},selectable:"raw",change:onChange,height:350,pageable:{refresh:!0,pageSizes:!0},scrollable:!0,persistSelection:!0,columns:[{selectable:!0,width:"50px",field:"AllowGRN"},{field:"Id",title:"Id",width:50},{field:"SubItemCode",title:"SubItemCode",width:100},{field:"SubItemName",title:"SubItemName",width:120},{field:"Qty",title:"Qty",encoded:!1,width:120},{field:"Unit",title:"Unit",width:100},{field:"MaterialDescription",title:"MaterialDescription",width:300},{field:"Amt",title:"Amt",width:100},]});$("#addtoarea").click(function(){var f=$("#myGrid").data("kendoGrid"),i,u,r,t,n;if(validation()){if(i=f.dataItem(f.select()),grndata.length>0){for(u=!1,r=0;r<grndata.length;r++)t=grndata[r],t.ItemId==i.Id&&(u=!0,t.ItemId=i.Id,t.zone=$("#zone").val(),t.WarehouseId=$("#WarehouseId").val(),t.Warea=$("#Warea").val(),t.Remark=$("#Remark").val(),t.wcode=$("#wcode").val(),t.zcode=$("#zcode").val(),t.acode=$("#acode").val(),t.Ponumber=$("#ponumber").val(),t.invoice=$("#invoiceNo").val(),toastr.success("Item "+i.Id+" successfully updated on area code"+t.acode+" in zone "+t.zone));u||(n={},n.ItemId=i.Id,n.zone=$("#zone").val(),n.WarehouseId=$("#WarehouseId").val(),n.Warea=$("#Warea").val(),n.Remark=$("#Remark").val(),n.wcode=$("#wcode").val(),n.zcode=$("#zcode").val(),n.acode=$("#acode").val(),n.Ponumber=$("#ponumber").val(),n.invoice=$("#invoiceNo").val(),grndata.push(n),toastr.success("Item "+i.Id+" successfully added on area code"+n.acode+" in zone "+n.zone))}else n={},n.ItemId=i.Id,n.zone=$("#zone").val(),n.WarehouseId=$("#WarehouseId").val(),n.Warea=$("#Warea").val(),n.Remark=$("#Remark").val(),n.wcode=$("#wcode").val(),n.zcode=$("#zcode").val(),n.acode=$("#acode").val(),n.Ponumber=$("#ponumber").val(),n.invoice=$("#invoiceNo").val(),n.GRNNumberOfSAP=$("#grnnumbersap").val(),n.IRN=$("#irn").val(),grndata.push(n),toastr.success("Item "+i.Id+" successfully added on area code"+n.acode+" in zone "+n.zone);console.log(n)}});$("#finalsave").click(function(){var t,n;validation()&&(t=$("#myGrid").data("kendoGrid"),grndata.length===0?alert("Please add atleast one item into warehouse areas."):(pleaseWait(),n={url:"/Grn/Complete",method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify(grndata)},$.ajax(n).done(function(){hideloading();window.location="/Grn/List"}).fail(function(){hideloading();alert("something went wrong please try again.")})))})});